{% extends 'pages/base.html' %}
{% load static %}
{% load custom_tags %}

{% block title %}
  Home - Dashboard
{% endblock %}

{% block extra_head %}
  <script async src="{% static 'js/plotly.min.js' %}"></script>
  <script async type="module" src="{% static 'js/chart_webcomponent.js' %}"></script>

  <link rel="stylesheet" href="{% static 'css/page_home.css' %}" />

  <script defer src="{% static 'js/page_home.js' %}"></script>
{% endblock %}

{% block content %}
  {% include 'sections/empty-message.html' %}

  {% if not empty %}
    <!-- section -->
    <div class="container_home">
      <aside class="sections_column">
        <h2>Available Sections</h2>
        <div class="search-container mb-4">
        <label for="sectionSearch" class="mb-2 text-sm font-medium text-gray-900 sr-only">Search</label>
        <div class="relative">
            <div class="search-icon">
                <svg class="w-4 h-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                </svg>
            </div>
            <input id="sectionSearch" type="search" class="search-input" placeholder="Search sections and charts" />
        </div>
        </div>
        {% for section in toc_data %}
          <div class="section-container">
            <div class="section-item">
              <a href="?section={{ section.slug }}"
                class="hover:underline {% if section.slug == selected_section_slug %}
                  text-blue-700
                {% else %}
                  text-black
                {% endif %}">
                {{ section.title }}
              </a>

              <button title="Expand section to see included charts" type="button" data-toggle="section-{{ section.slug }}">+</button>
            </div>

            <ul data-section-id="section-{{ section.slug }}" class="sub-sections hidden">
              {% for chart in section.charts %}
              <li>
                <a class="sub-section-item" href="?section={{ section.slug }}#chart_{{ chart.slug }}">{{ chart.title }}</a>
              </li>
              {% endfor %}
            </ul>
          </div>
        {% endfor %}
      </aside>

      <main class="section_charts">
        <h2 class="{% if forloop.first %}first{% endif %}">{{ selected_section_title }}</h2>

        <div class="grid grid-cols-8 gap-4">
          {% for chart in selected_charts %}
            <plotly-chart chart_slug="{{ chart.slug }}" q="{{ chart.quarter_number }}"></plotly-chart>
          {% endfor %}
        </div>
      </main>
    </div>

    {% include 'sections/scroll-to-top.html' %}
  {% endif %}

  <script>
   
  </script>
{% endblock %}
